/*
All of the code within the ZingChart software is developed and copyrighted by ZingChart, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from ZingChart. All usage must coincide with the
ZingChart End User License Agreement which can be requested by email at support@zingchart.com.

Build 2.9.4_ES6
*/
zingchart.setModule("heatmap"),function(){if(zingchart.plugins.heatmap=zingchart.plugins.heatmap||{},!ZC.ZCHeatMap){var t={};ZC.ZCHeatMap=function(){this.AB="canvas",this.I=0,this.F=0,this.aDataInit=null,this.aData=[],this.oKVData={},this.aSize=[15,15],this.iBlur=45,this.LV=!1,this.A7=null,this.bComposite=!0,this.aGradient=[[.4,"#0000ff"],[.6,"#00ffff"],[.7,"#bfff00"],[.8,"#ffff00"],[1,"#ff0000"]],this.oGradientData=null,this.oBrush=null,this.sBrushType="circle",this.sBrushInfo=null,this.bSortData=!1,this.addData=function(t){this.aData.push(t)},this.setData=function(t,a){if(this.ABC&&-1===a.indexOf("scatter"))for(var e=0,i=t.length;e<i;e++)this.oKVData[t[e][0]+"/"+t[e][1]]=t[e][2];this.aData=t,this.aDataInit||(this.aDataInit=t),this.bSortData&&this.aData.sort(function(t,a){return t[2]-a[2]})},this.B3=null,this.BK=null,this.C5=.5,this.Z=null,this.ABC=null,this.setMinMax=function(){if(null===this.B3||null===this.BK)for(var t=0,a=this.aData.length;t<a;t++)this.B3=Math.min(this.B3,this.aData[t][2]),this.BK=Math.max(this.BK,this.aData[t][2])},this.createGradient=function(){var t=document.createElement("canvas"),a=t.getContext("2d"),e=a.createLinearGradient(0,0,0,256);t.width=1,t.height=256;for(var i=0;i<this.aGradient.length;i++)e.addColorStop(this.aGradient[i][0],this.aGradient[i][1]);a.fillStyle=e,a.fillRect(0,0,1,256),this.oGradientData=a.getImageData(0,0,1,256).data},this.createBrush=function(){var t=document.createElement("canvas"),a=t.getContext("2d");"circle"===this.sBrushType?t.width=t.height=2*(this.aSize[0]+this.iBlur):"square"===this.sBrushType?t.width=t.height=this.aSize[0]+2*this.iBlur:"rectangle"===this.sBrushType&&(t.width=this.aSize[0]+2*this.iBlur,t.height=this.aSize[1]+2*this.iBlur),a.shadowOffsetX=a.shadowOffsetY=200,a.shadowBlur=this.iBlur,a.shadowColor="#000","circle"===this.sBrushType?(a.beginPath(),a.arc(this.aSize[0]+this.iBlur-200,this.aSize[0]+this.iBlur-200,this.aSize[0],0,2*Math.PI,!0),a.closePath(),a.fill()):"square"===this.sBrushType?a.fillRect(this.iBlur-200,this.iBlur-200,this.aSize[0],this.aSize[0]):"rectangle"===this.sBrushType&&a.fillRect(this.iBlur-200,this.iBlur-200,this.aSize[0],this.aSize[1]),this.oBrush=t},this.reset=function(){this.aData=this.aDataInit},this.paint=function(){var t,a,e;if(this.aData.length){this.UID=this.UID?++this.UID:1;var i=this.Z.getContext("2d"),s=this,h=null,r=null;if(!this.ABC||((h=zingchart.getLoader(this.ABC.loaderid))&&(r=zingchart.getGraph(h,this.ABC[ZC._[3]])),r)){if(this.ABC){var n=zingchart.exec(this.ABC.loaderid,"getobjectinfo",{graphid:this.ABC[ZC._[3]],object:"plotarea"});n&&(i.beginPath(),i.rect(n.x,n.y,n.width,n.height),i.clip(),i.closePath());var l=zingchart.exec(this.ABC.loaderid,"getobjectinfo",{object:"scale",name:this.ABC.keyscale.name}),o=zingchart.exec(this.ABC.loaderid,"getobjectinfo",{object:"scale",name:this.ABC.valscale.name});if(l&&o){var c=(l.step+"").split(".");this.ABC.keyscale.decimals=2===c.length?c[1].length:0;var u=(o.step+"").split(".");this.ABC.valscale.decimals=2===u.length?u[1].length:0;var C=[],d=[],f=0,g=0,p=[];"xy"===r.AJ.layout?-1===r.AF.indexOf("scatter")&&(this.aSize=[Math.ceil(l.stepSize)+.5,Math.ceil(o.stepSize)+.5]):"radar"===r.AJ.layout&&(d=[l.x+l.width/2,l.y+l.height/2]);var B=r.BI(this.ABC.keyscale.name),m=r.BI(this.ABC.valscale.name),Z=[],v={},x=1;if(-1!==r.AF.indexOf("scatter")&&this.aData.length>1e5){var y=Math.max((B.BK-B.B3)/(B.V[B.V.length-1]-B.V[0]),(m.BK-m.B3)/(m.H2-m.FX));x=Math.max(1,Math.round(5*y))}for(t=0,a=this.aData.length;t<a;t++)if((e=this.aData[t])[0]>=B.B3&&e[0]<=B.BK&&e[1]>=m.B3&&e[1]<=m.BK){var A=B.AM(e[0]),_=m.AM(e[1]);"radar"===r.AJ.layout?(f=180*Math.atan2(A[1]-d[1],A[0]-d[0])/Math.PI,g=d[1]-_[1]+o.offsetStart,p=ZC.AQ.BM(d[0],d[1],g,f),C.push([p[0],p[1],e[2],e[3]])):(C.push([A,_,e[2],e[3]]),-1!==r.AF.indexOf("scatter")&&(x>1?v[x*Math.round(A/x)+"/"+x*Math.round(_/x)]=e:v[Math.round(A)+"/"+Math.round(_)]=e))}if(-1!==r.AF.indexOf("scatter")){for(var D in v){var K=D.split("/");Z.push({x:parseFloat(K[0]),y:parseFloat(K[1]),key:v[D][0],val:v[D][1],v:v[D][2],info:v[D][3]})}this.oKDTree=new ZC.ZCKDTree(Z)}this.aData=C}}this.oGradientData||this.createGradient(),this.sBrushInfo||(this.sBrushInfo=[this.sBrushType,this.aSize[0],this.aSize[1]].join("-")),this.oBrush&&this.sBrushInfo===[this.sBrushType,this.aSize[0],this.aSize[1]].join("-")||(this.createBrush(),this.sBrushInfo=[this.sBrushType,this.aSize[0],this.aSize[1]].join("-")),this.setMinMax(),i.clearRect(0,0,s.I,s.F);var z=this.LV?25:1,M=this.UID,b=function(h,r,n){for(t=h;t<r;t++)if(e=s.aData[t]){var l=1;if(s.B3!==s.BK&&(l=Math.max((e[2]-s.B3)/(s.BK-s.B3),.01)),s.ABC&&!s.bComposite){var o=4*Math.floor(255*l),c=s.oGradientData[o],u=s.oGradientData[o+1],C=s.oGradientData[o+2];i.fillStyle="rgb("+c+","+u+","+C+")","circle"===s.sBrushType?(i.beginPath(),i.arc(e[0],e[1],s.aSize[0],0,2*Math.PI),i.fill(),i.closePath()):i.fillRect(e[0]-s.aSize[0]/2,e[1]-s.aSize[1]/2,s.aSize[0],s.aSize[1])}else i.globalAlpha=l,"circle"===s.sBrushType?i.drawImage(s.oBrush,e[0]-s.aSize[0]-s.iBlur,e[1]-s.aSize[0]-s.iBlur):"square"===s.sBrushType?i.drawImage(s.oBrush,e[0]-s.aSize[0]/2-s.iBlur,e[1]-s.aSize[0]/2-s.iBlur):"rectangle"===s.sBrushType&&i.drawImage(s.oBrush,e[0]-s.aSize[0]/2-s.iBlur,e[1]-s.aSize[1]/2-s.iBlur)}if(!s.ABC||s.bComposite){var d=i.getImageData(0,0,s.I,s.F);for(t=3,a=d.data.length;t<a;t+=4){var f=4*d.data[t];f&&(d.data[t-3]=s.oGradientData[f],d.data[t-2]=s.oGradientData[f+1],d.data[t-1]=s.oGradientData[f+2])}i.putImageData(d,0,0)}r=Math.min(s.aData.length,r+Math.round(s.aData.length/z)),h=Math.min(s.aData.length,h+Math.round(s.aData.length/z)),s.UID===M&&(!n&&s.LV?("svg"===s.AB&&ZC.AK(s.Z.id.replace(/\-c$/,"-img")).setAttribute("href",s.Z.toDataURL()),window.setTimeout(function(){b(h,r,r>=s.aData.length)},1)):function(){var t=i.getImageData(0,0,s.I,s.F);i.clearRect(0,0,s.I,s.F);for(var a=3,e=t.data.length;a<e;a+=4)t.data[a]/=1/s.C5;i.putImageData(t,0,0),s.Z.style.opacity=1,"svg"===s.AB&&ZC.AK(s.Z.id.replace(/\-c$/,"-img")).setAttribute("href",s.Z.toDataURL())}())};this.aData.length&&b(0,Math.round(this.aData.length/z))}}},this.clear=function(){this.aData=[]}},zingchart.bind(null,"postzoom",function(a){var e=zingchart.getLoader(a.id),i=zingchart.getModules(e);if(-1!==ZC.AV(i,"heatmap"))for(var s=0,h=e.AG.length;s<h;s++){var r=e.AG[s];if(r.o.heatmap){var n=t[e.K+"-"+r.L];n.reset(),n.paint()}}}),zingchart.bind(null,ZC._[48],function(a){var e=zingchart.getLoader(a.id),i=zingchart.getModules(e);if(-1!==ZC.AV(i,"heatmap"))for(var s=0,h=e.AG.length;s<h;s++){var r=e.AG[s];if(r.o.heatmap&&ZC.DR(a.x,r.iX,r.iX+r.I)&&ZC.DR(a.y,r.iY,r.iY+r.F)){var n,l=t[e.K+"-"+r.L],o=null;if(l){var c,u="",C="",d=null;if(-1===r.AF.indexOf("scatter"))if(l.ABC&&!l.bComposite){if(ZC.DR(a.x,r.P.iX,r.P.iX+r.P.I)&&ZC.DR(a.y,r.P.iY,r.P.iY+r.P.F)){for(var f=zingchart.exec(a.id,"getxyinfo",{x:a.x,y:a.y}),g=0;g<f.length;g++)"key-scale"===f[g].infotype&&(u=f[g].scalevalue.toFixed(l.ABC.keyscale.decimals)),"value-scale"===f[g].infotype&&(C=f[g].scalevalue.toFixed(l.ABC.valscale.decimals));o=l.oKVData[u+"/"+C]}}else{var p=l.Z.getContext("2d").getImageData(0,0,l.I,l.F).data[4*(Math.round(a.x-r.iX)+Math.round(a.y-r.iY)*l.I)+3];p=Math.min(255,Math.round(p*(1/l.C5))),o=l.B3+(l.BK-l.B3)*p/255,p<=0&&(o=null)}else(c=l.oKDTree.getNearestNeighbour({x:a.x,y:a.y},20))&&(o=c.v,u=c.key,C=c.val,d=c.info);if(ZC.AP.C0("heatmap.mousemove",e,{id:e.K,graphid:r.K,ev:a.ev,x:a.x,y:a.y,value:o}),l.A7)if(null!==ZC._n_(o)){if(a.ev.target&&"AREA"!==a.ev.target.tagName.toUpperCase()){var B=u,m=u,Z=C,v=C;if(l.ABC){var x=r.BI(l.ABC.keyscale.name);if(x){var y=x.LX();y[ZC._[68]]&&(y.utc=r.UX,y.timezone=r.NI,m=ZC.AP.G3(m,y,r.BN[0],!0))}var A=r.BI(l.ABC.valscale.name);A&&A.CH&&(v=A.CH.replace(/%v|%scale-value/g,v))}if(n={},ZC._cp_(l.A7,n),-1!==r.AF.indexOf("scatter")&&(n.x=c.x,n.y=c.y-("canvas"===e.AB?0:20),n.anchor="c",n[ZC._[7]]="xy"),l.A7["js-rule"])try{var _=ZC.execFn(l.A7["js-rule"].replace("javascript:","").replace("()",""),window,{key:u,val:C,v:o},d);_&&ZC._cp_(_,n)}catch(D){}o=zingchart.formatNumber(o,l.A7),n.text=n.text||o+"",-1!==n.text.indexOf("%")&&(n.text=n.text.replace(/%value/g,o+"").replace(/%scale-key-text/g,m).replace(/%scale-key-value/g,B).replace(/%scale-value-text/g,v).replace(/%scale-value-value/g,Z)),zingchart.exec(a.id,"showtooltip",{ev:a.ev,xy:!0,data:n})}}else a.ev.target&&"AREA"!==a.ev.target.tagName.toUpperCase()&&zingchart.exec(a.id,"hidetooltip",{})}}}}),zingchart.bind(null,"load",function(a){var e=zingchart.getLoader(a.id),i=zingchart.getModules(e);if(-1!==ZC.AV(i,"heatmap"))for(var s=0,h=e.AG.length;s<h;s++){var r=e.AG[s];if(r.o.heatmap){var n=r.o.heatmap||{};r.o.options&&(n=r.o.options.heatmap||n),ZC._todash_(n);var l=document.createElement("canvas");l.id=r.K+"-heatmap-c",l.className="canvas"===e.AB?"":"zc-no-print",l.width=r.I,l.height=r.F;var o,c=ZC._c_(n[ZC._[7]],n.graph?"bottom":"top");if("canvas"===e.AB)"top"===c?ZC.AK(e.K+"-tools").appendChild(l):(o=ZC.AK(r.K+"-plots-bl-0")||ZC.AK(r.K+"-plots-bl")).appendChild(l);else{var u=ZC.Q.F7("foreignObject",ZC._[36]);u.id=r.K+"-heatmap",ZC.Q.G9(u,{x:r.iX,y:r.iY,width:r.I,height:r.F}),u.style.opacity=0,u.appendChild(l);var C=ZC.Q.F7("image",ZC._[36]);C.id=r.K+"-heatmap-img",ZC.Q.G9(C,{x:r.iX,y:r.iY,width:r.I,height:r.F,href:""}),"top"===c?(ZC.AK(e.K+"-tools").appendChild(u),ZC.AK(e.K+"-tools").appendChild(C)):((o=ZC.AK(r.K+"-plots-bl-0")||ZC.AK(r.K+"-plots-bl")).appendChild(u),o.appendChild(C))}var d=t[e.K+"-"+r.L]=new ZC.ZCHeatMap;d.I=e.I,d.F=e.F,d.Z=l,d.AB=e.AB,"canvas"===e.AB&&(d.Z.style.position="absolute",d.Z.style.left=r.iX+"px",d.Z.style.top=r.iY+"px"),d.sBrushType=ZC._c_(n["brush-type"],"circle");var f=[[15,15],45];"square"===d.sBrushType?f=[[15,15],5]:"rectangle"===d.sBrushType&&(f=[[10,15],5]),d.aSize=ZC._c_(n[ZC._[21]],f[0]),"object"!=typeof d.aSize&&(d.aSize=[ZC._f_(d.aSize),ZC._f_(d.aSize)]),d.iBlur=ZC._i_(ZC._c_(n.blur,f[1])),d.LV=ZC._b_(ZC._c_(n.async,!1)),d.bSortData=ZC._b_(ZC._c_(n["sort-data"],!1)),d.C5=ZC._f_(ZC._c_(n.alpha,.5)),n.tooltip&&(d.A7=n.tooltip),ZC._n_(n["min-value"])&&(d.B3=ZC._f_(n["min-value"])),ZC._n_(n["max-value"])&&(d.BK=ZC._f_(n["max-value"])),d.Z.style.opacity=d.C5,n.graph&&(d.bComposite=!1,d.ABC={loaderid:e.K,graphid:r.K,keyscale:{name:ZC._[50],decimals:0},valscale:{name:ZC._[51],decimals:0}},n.graph["key-scale"]&&(d.ABC.keyscale.name=n.graph["key-scale"]),n.graph["val-scale"]&&(d.ABC.valscale.name=n.graph["val-scale"])),ZC._n_(n.composite)&&(d.bComposite=ZC._b_(n.composite));var g=["#0000ff","#00ffff","#bfff00","#ffff00","#ff0000"],p=[.4,.6,.7,.8,1];n["gradient-colors"]&&(g=n["gradient-colors"].split(/\s|;/)),n["gradient-stops"]&&(p=n["gradient-stops"].split(/\s|;/)),d.aGradient=[];for(var B=0;B<Math.min(g.length,p.length);B++)d.aGradient.push([p[B],g[B]]);d.paint()}}}),zingchart.extendAPI("heatmap.setdata",function(a,e){"string"==typeof(e=e||{})&&(e=JSON.parse(e)),ZC._todash_(e,!0,"data");var i=zingchart.getLoader(a);if(i){var s=i.C8(e[ZC._[3]]);if(s){var h=i.K+"-"+s.L;t&&t[h]&&(null!==ZC._n_(e["min-value"])&&(t[h].B3=ZC._f_(e["min-value"])),null!==ZC._n_(e["max-value"])&&(t[h].BK=ZC._f_(e["max-value"])),null!==ZC._n_(e[ZC._[21]])&&(t[h].aSize=[ZC._f_(e[ZC._[21]]),ZC._f_(e[ZC._[21]])]),null!==ZC._n_(e.blur)&&(t[h].iBlur=ZC._f_(e.blur)),t[h].setData(e.data||[],s.AF),t[h].paint())}}}),ZC.ZCKDTreeNode=function(t){this.aPoint=t,this.oLeftChild=null,this.oRightChild=null,this.oBounds=null},ZC.ZCKDTree=function(t){for(var a={minX:ZC.MAX,maxX:-ZC.MAX,minY:ZC.MAX,maxY:-ZC.MAX},e=0,i=t.length;e<i;e++)a.minX=Math.min(a.minX,t[e].x),a.maxX=Math.max(a.maxX,t[e].x),a.minY=Math.min(a.minY,t[e].y),a.maxY=Math.max(a.maxY,t[e].y);this.MP=ZC.ZCKDTree.createKDTree(t,0,a)},ZC.ZCKDTree.createKDTree=function(t,a,e){if(0===t.length)return null;var i=a%2;t.sort(function(t,a){return 0===i?t.x-a.x:t.y-a.y});var s=Math.floor(t.length/2),h=new ZC.ZCKDTreeNode(t[s]);h.oBounds=e;var r={minX:e.minX,maxX:0===i?h.aPoint.x:e.maxX,minY:e.minY,maxY:1===i?h.aPoint.y:e.maxY},n={minX:0===i?h.aPoint.x:e.minX,maxX:e.maxX,minY:1===i?h.aPoint.y:e.minY,maxY:e.maxY};return h.oLeftChild=ZC.ZCKDTree.createKDTree(t.slice(0,s),a+1,r),h.oRightChild=ZC.ZCKDTree.createKDTree(t.slice(s+1),a+1,n),h},ZC.ZCKDTree.getDistance=function(t,a,e,i){return Math.sqrt((t-e)*(t-e)+(a-i)*(a-i))},ZC.ZCKDTree.prototype.getNearestNeighbour=function(t,a,e){var i=[];return this._getNearestNeighbours_(this.MP,t,0,i,1,e),0===i.length?null:i[0].H1<=a?i[0].AX.aPoint:null},ZC.ZCKDTree.prototype.getNearestNeighbours=function(t,a,e,i){var s=[];this._getNearestNeighbours_(this.MP,t,0,s,a,i);for(var h=[],r=0,n=s.length;r<n;r++)s[r].H1<=e&&h.push(s[r].AX.aPoint);return h},ZC.ZCKDTree.prototype._getNearestNeighbours_=function(t,a,e,i,s,h){h&&h.push(t.aPoint);var r=e%2,n={AX:t,H1:ZC.ZCKDTree.getDistance(a.x,a.y,t.aPoint.x,t.aPoint.y)};ZC.ZCKDTree.insertResult(i,n,s);var l,o,c=(0===r?a.x:a.y)<(0===r?t.aPoint.x:t.aPoint.y),u=c?t.oLeftChild:t.oRightChild,C=c?t.oRightChild:t.oLeftChild;(u&&this._getNearestNeighbours_(u,a,e+1,i,s,h),C)&&(0===r?(l=t.aPoint.x,o=a.y,a.y<C.oBounds.minY?o=C.oBounds.minY:a.y>C.oBounds.maxY&&(o=C.oBounds.maxY)):(l=a.x,o=t.aPoint.y,a.x<C.oBounds.minX?l=C.oBounds.minX:a.x>C.oBounds.maxX&&(l=C.oBounds.maxX)),ZC.ZCKDTree.getDistance(a.x,a.y,l,o)<=i[i.length-1].H1&&this._getNearestNeighbours_(C,a,e+1,i,s,h))},ZC.ZCKDTree.insertResult=function(t,a,e){var i;for(i=t.length-1;i>=0;--i){var s=t[i];if(a.H1>s.H1)break}t.splice(i+1,0,a),t.length>e&&t.pop()}}}();
